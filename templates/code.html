<div class="columns">
  <div class="column">
    <div class="editor">
    </div>
  </div>
  <div class="column">
    <img src="https://alpstore.blob.core.windows.net/pictures/{{key}}" id="fixed-img">
  </div>
</div>

<input class="button is-danger" id="upload-code" type="submit" value="Reupload code">

<div class="columns">
  <div class="column">
    <div class="field">
      <div class="control">
        <textarea class="textarea is-success" id="result-area" type="text" readonly>{{result}}</textarea>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="field">
      <div class="control">
        <textarea class="textarea is-danger" id="error-area" type="text" readonly>{{error}}</textarea>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  let $container = document.querySelector(".editor");
  let cm = CodeMirror($container, {
    value: {{fixed|tojson}},
    lineNumbers: true,
    theme: "monokai"
  });

  $("#upload-code").bind("click", function(){
    $.ajax({
      url: '/resubmit',
      data: JSON.stringify( { "code": cm.getValue(), "key": "{{key}}" } ),
      processData: false,
      contentType: 'application/json',
      type: 'POST',
      success: function(response) {
        var json = $.parseJSON(response);
        $('#result-area').val(json.result);
        $('#error-area').val(json.error);
      }
    });
  });
</script>
